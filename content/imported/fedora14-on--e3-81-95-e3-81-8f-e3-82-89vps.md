Title: Fedora14 on さくらVPS
Date: 2011-02-12 04:44
Author: masayukig
Tags: このサイトのこと, さくら, Fedora, fedora14, OS, server, VPS
Status: published

このサイトのサーバは、[さくらのVPS]で動作していますが、今まで、CentOS5だったのを、Fedora14に変更しました。



以下、その時につまずいたところなどを、記してみたいと思います。

OSのインストール自体は、  
[カスタムOSインストールガイド ： Fedora
13](http://support.sakura.ad.jp/support/vps/menu_oscustom_fedora.shtml)に従って行えば、特に困るところは無いと思います。

ただし、私の環境だと、  
「\[STEP 13\] VPSの停止と起動」で、VNCコンソール(QEMUコンソール)の  
ウィンドウが消えてしまうことがあったのですが、その場合には、  
VPSコントロールパネルのリモートコンソール  
[![sakura vps remote
console](http://farm6.static.flickr.com/5092/5436912432_e26d889434.jpg){width="500"
height="211"}](http://www.flickr.com/photos/masayun/5436912432/ "sakura vps remote console by masayukig, on Flickr")  
の、「VNCコンソールを開く」をやれば大丈夫だと思います。

また、「\[STEP 10\]
インストールタイプの選択」では、私は「Webサーバ」を選択しました。  
特に問題はありません。

Fedora13がインストールできたら、次は、このブログ記事のタイトル  
「Fedora14」へアップグレードします。(まだ道半ばです(笑))

Fedora14のインストールは簡単です。

-   [Fedora 13 → Fedora 14 へ preupgrade-cli
    でアップグレード](http://blog.tnmt.info/2010/11/06/upgrade-fedora-13-to-14-using-preupgrade/)
-   [Fedora
    13から14へアップグレードする方法](http://journal.mycom.co.jp/articles/2010/11/09/upgrading-fedora-from-13-to-14/index.html)

あたりの記事を参考に、アップグレードします。

要は、  
\[bash\]  
\# yum update rpm  
\# yum -y update  
\# yum clean all  
\# reboot  
\[/bash\]  
てな感じで、ひとまず(Fedora13の)最新版にしておき、

preupgradeをインストール。(既にインストールされている場合もあり)  
\[bash\]  
\# yum install preupgrade  
\[/bash\]

preupgrade-cliを実行。  
\[bash\]  
\# LANG=C preupgrade-cli "Fedora 14 (Laughlin)"  
\[/bash\]  
LANG=Cで実行しないと、エラーが発生するらしいです。

で、これでFedora14になりました。

あとは、必要な設定を随時行っていきます。  
ちょっとつまずいたのは、パーマリンクの設定。

以下のように、httpd.confのAllowOverride NoneをAllowOverride Allに  
変更してやる必要がありました。  
[パーマリンクの使い方:その他の問題点](http://wpdocs.sourceforge.jp/%E3%83%91%E3%83%BC%E3%83%9E%E3%83%AA%E3%83%B3%E3%82%AF%E3%81%AE%E4%BD%BF%E3%81%84%E6%96%B9#.E3.81.9D.E3.81.AE.E4.BB.96.E3.81.AE.E5.95.8F.E9.A1.8C.E7.82.B9)

また、Webサーバとして使うので、GUIでのログインは不要なので、  
/etc/inittabを以下のように変更し、ランレベル３で動作するようにします。  
\[text\]  
diff --git a/inittab b/inittab  
index a8ab066..b6a0b26 100644  
--- a/inittab  
+++ b/inittab  
@@ -23,4 +23,5 @@  
\# 5 - X11  
\# 6 - reboot (Do NOT set initdefault to this)  
\#  
-id:5:initdefault:  
+\#id:5:initdefault:  
+id:3:initdefault:  
\[/text\]

また、不要なサービス(bluetooth, pcscd, cups)あたりを、  
\[bash\]  
\$ sudo chkconfig サービス名 off  
\[/bash\]  
で、起動しないようにしました。

また、メモリが少ないので、デフォルトのhttpd設定だと、オーバースペックで、  
メモリを圧迫し、動作が遅くなるので、設定値をしぼります。

\[text\]  
@@ -98,12 +101,12 @@ KeepAliveTimeout 15  
\# MaxClients: maximum number of server processes allowed to start  
\# MaxRequestsPerChild: maximum number of requests a server process
serves

-StartServers 8  
-MinSpareServers 5  
-MaxSpareServers 20  
-ServerLimit 256  
-MaxClients 256  
-MaxRequestsPerChild 4000  
+StartServers 4  
+MinSpareServers 3  
+MaxSpareServers 5  
+ServerLimit 64  
+MaxClients 64  
+MaxRequestsPerChild 2000

\# worker MPM  
@@ -115,10 +118,10 @@ MaxRequestsPerChild 4000  
\# MaxRequestsPerChild: maximum number of requests a server process
serves

StartServers 2  
-MaxClients 150  
-MinSpareThreads 25  
-MaxSpareThreads 75  
-ThreadsPerChild 25  
+MaxClients 50  
+MinSpareThreads 5  
+MaxSpareThreads 10  
+ThreadsPerChild 9  
MaxRequestsPerChild 0

\[/text\]

自由度の高い、さくらVPSかなりいい感じです。  
後は、メモリ追加オプションがあれば、言うこと無いです。  
